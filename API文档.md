# DormDB API æ–‡æ¡£

## ğŸ“– æ¦‚è¿°

DormDB æä¾› RESTful API æ¥å£ï¼Œæ”¯æŒæ•°æ®åº“è‡ªåŠ©ç”³è¯·ã€çŠ¶æ€æŸ¥è¯¢å’Œç®¡ç†åŠŸèƒ½ã€‚æ‰€æœ‰ API éƒ½è¿”å›ç»Ÿä¸€çš„ JSON æ ¼å¼å“åº”ã€‚

**Base URL**: `http://localhost:3000/api/v1`

**API æ–‡æ¡£**: `http://localhost:3000/swagger-ui/`

## ğŸ”§ é€šç”¨å“åº”æ ¼å¼

æ‰€æœ‰ API æ¥å£éƒ½ä½¿ç”¨ç»Ÿä¸€çš„å“åº”æ ¼å¼ï¼š

```json
{
  "code": 0,                    // ä¸šåŠ¡çŠ¶æ€ç ï¼Œ0è¡¨ç¤ºæˆåŠŸ
  "message": "Success",         // å“åº”æ¶ˆæ¯
  "data": {                     // å“åº”æ•°æ®ï¼ˆå¯é€‰ï¼‰
    // å…·ä½“çš„å“åº”æ•°æ®
  }
}
```

### çŠ¶æ€ç è¯´æ˜

| çŠ¶æ€ç  | å«ä¹‰ | è¯´æ˜ |
|--------|------|------|
| 0 | æˆåŠŸ | æ“ä½œæˆåŠŸå®Œæˆ |
| 40001 | å‚æ•°é”™è¯¯ | è¯·æ±‚å‚æ•°æ— æ•ˆæˆ–ç¼ºå¤± |
| 40901 | èµ„æºå†²çª | èº«ä»½æ ‡è¯†å·²å­˜åœ¨ |
| 50001 | å†…éƒ¨é”™è¯¯ | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |
| 50002 | æ•°æ®åº“æ“ä½œå¤±è´¥ | æ•°æ®åº“åˆ›å»ºæˆ–é…ç½®å¤±è´¥ |

## ğŸ” ç”¨æˆ·æ¥å£

### 1. ç”³è¯·æ•°æ®åº“

åˆ›å»ºæ–°çš„æ•°æ®åº“å®ä¾‹å’Œç”¨æˆ·è´¦å·ã€‚

**æ¥å£ä¿¡æ¯**
- **URL**: `/api/v1/apply`
- **æ–¹æ³•**: `POST`
- **Content-Type**: `application/json`

**è¯·æ±‚å‚æ•°**
```json
{
  "identity_key": "20250701"    // ç”¨æˆ·èº«ä»½æ ‡è¯†ï¼Œå¦‚å­¦å·
}
```

**å‚æ•°è¯´æ˜**
| å‚æ•° | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| identity_key | string | æ˜¯ | ç”¨æˆ·å”¯ä¸€èº«ä»½æ ‡è¯†ï¼Œå»ºè®®ä½¿ç”¨å­¦å·ã€å·¥å·ç­‰ |

**æˆåŠŸå“åº”** (HTTP 200)
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "db_host": "sql.iluwen.cn",           // æ•°æ®åº“ä¸»æœºåœ°å€
    "db_port": 49500,                     // æ•°æ®åº“ç«¯å£
    "db_name": "db_20250701",             // æ•°æ®åº“åç§°
    "username": "user_20250701",          // æ•°æ®åº“ç”¨æˆ·å
    "password": "GeneratedSecurePassword123"  // æ•°æ®åº“å¯†ç 
  }
}
```

**é”™è¯¯å“åº”ç¤ºä¾‹**

èº«ä»½æ ‡è¯†å·²å­˜åœ¨ (HTTP 409)
```json
{
  "code": 40901,
  "message": "Identity key already exists.",
  "data": null
}
```

å‚æ•°é”™è¯¯ (HTTP 400)
```json
{
  "code": 40001,
  "message": "Invalid input parameter.",
  "data": null
}
```

**ä½¿ç”¨ç¤ºä¾‹**
```bash
curl -X POST http://localhost:3000/api/v1/apply \
  -H "Content-Type: application/json" \
  -d '{"identity_key": "20250701"}'
```

### 2. å¥åº·æ£€æŸ¥

æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚

**æ¥å£ä¿¡æ¯**
- **URL**: `/api/v1/health`
- **æ–¹æ³•**: `GET`

**æˆåŠŸå“åº”** (HTTP 200)
```json
{
  "code": 0,
  "message": "Success",
  "data": "æœåŠ¡è¿è¡Œæ­£å¸¸"
}
```

**ä½¿ç”¨ç¤ºä¾‹**
```bash
curl http://localhost:3000/api/v1/health
```

## ğŸ‘¨â€ğŸ’¼ ç®¡ç†å‘˜æ¥å£

### 1. è·å–ç³»ç»ŸçŠ¶æ€

è·å–è¯¦ç»†çš„ç³»ç»Ÿè¿è¡ŒçŠ¶æ€ä¿¡æ¯ã€‚

**æ¥å£ä¿¡æ¯**
- **URL**: `/api/v1/admin/status`
- **æ–¹æ³•**: `GET`

**æˆåŠŸå“åº”** (HTTP 200)
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "uptime": "2 hours 15 minutes",      // æœåŠ¡è¿è¡Œæ—¶é—´
    "database_status": "Connected",       // SQLite è¿æ¥çŠ¶æ€
    "mysql_status": "Connected",          // MySQL è¿æ¥çŠ¶æ€
    "total_applications": 156,            // æ€»ç”³è¯·æ•°é‡
    "today_applications": 23,             // ä»Šæ—¥ç”³è¯·æ•°é‡
    "version": "1.0.0"                    // ç³»ç»Ÿç‰ˆæœ¬
  }
}
```

**ä½¿ç”¨ç¤ºä¾‹**
```bash
curl http://localhost:3000/api/v1/admin/status
```

### 2. è·å–ç”³è¯·ç»Ÿè®¡

è·å–ç”³è¯·ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯ã€‚

**æ¥å£ä¿¡æ¯**
- **URL**: `/api/v1/admin/stats`
- **æ–¹æ³•**: `GET`

**æˆåŠŸå“åº”** (HTTP 200)
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "total_applications": 156,            // æ€»ç”³è¯·æ•°é‡
    "today_applications": 23,             // ä»Šæ—¥ç”³è¯·æ•°é‡
    "success_rate": 98.5                  // ç”³è¯·æˆåŠŸç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰
  }
}
```

**ä½¿ç”¨ç¤ºä¾‹**
```bash
curl http://localhost:3000/api/v1/admin/stats
```

### 3. è·å–æ‰€æœ‰ç”³è¯·è€…

è·å–æ‰€æœ‰å·²ç”³è¯·ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ã€‚

**æ¥å£ä¿¡æ¯**
- **URL**: `/api/v1/applicants`
- **æ–¹æ³•**: `GET`

**æˆåŠŸå“åº”** (HTTP 200)
```json
{
  "code": 0,
  "message": "Success",
  "data": [
    {
      "id": 1,                            // ç”³è¯·è®°å½•ID
      "identity_key": "20250701",         // ç”¨æˆ·èº«ä»½æ ‡è¯†
      "db_name": "db_20250701",           // æ•°æ®åº“åç§°
      "db_user": "user_20250701",         // æ•°æ®åº“ç”¨æˆ·å
      "created_at": "2025-07-13T15:00:00Z" // åˆ›å»ºæ—¶é—´
    },
    {
      "id": 2,
      "identity_key": "20250702",
      "db_name": "db_20250702",
      "db_user": "user_20250702",
      "created_at": "2025-07-13T16:30:00Z"
    }
  ]
}
```

**ä½¿ç”¨ç¤ºä¾‹**
```bash
curl http://localhost:3000/api/v1/applicants
```

### 4. æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥å’Œä¿®å¤

æ£€æŸ¥ MySQL å’Œ SQLite ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå¹¶è‡ªåŠ¨ä¿®å¤ä¸ä¸€è‡´çš„æ•°æ®ã€‚

**æ¥å£ä¿¡æ¯**
- **URL**: `/api/v1/admin/repair`
- **æ–¹æ³•**: `POST`

**æˆåŠŸå“åº”** (HTTP 200)
```json
{
  "code": 0,
  "message": "Success",
  "data": "æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥å®Œæˆï¼Œå‘ç°å¹¶ä¿®å¤äº† 2 ä¸ªä¸ä¸€è‡´é¡¹"
}
```

**ä½¿ç”¨ç¤ºä¾‹**
```bash
curl -X POST http://localhost:3000/api/v1/admin/repair
```

## ğŸ” é”™è¯¯å¤„ç†

### HTTP çŠ¶æ€ç 

| HTTP çŠ¶æ€ç  | è¯´æ˜ |
|-------------|------|
| 200 | è¯·æ±‚æˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 409 | èµ„æºå†²çªï¼ˆå¦‚èº«ä»½æ ‡è¯†å·²å­˜åœ¨ï¼‰ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

### ä¸šåŠ¡é”™è¯¯ç è¯¦è§£

#### 40001 - å‚æ•°é”™è¯¯
- **åŸå› **: è¯·æ±‚å‚æ•°æ ¼å¼é”™è¯¯ã€ç¼ºå¤±å¿…éœ€å‚æ•°æˆ–å‚æ•°å€¼æ— æ•ˆ
- **è§£å†³**: æ£€æŸ¥è¯·æ±‚å‚æ•°æ ¼å¼å’Œå†…å®¹

#### 40901 - èº«ä»½æ ‡è¯†å·²å­˜åœ¨
- **åŸå› **: æä¾›çš„èº«ä»½æ ‡è¯†å·²ç»ç”³è¯·è¿‡æ•°æ®åº“
- **è§£å†³**: ä½¿ç”¨ä¸åŒçš„èº«ä»½æ ‡è¯†æˆ–è”ç³»ç®¡ç†å‘˜

#### 50001 - å†…éƒ¨é”™è¯¯
- **åŸå› **: æœåŠ¡å™¨å†…éƒ¨å¤„ç†é”™è¯¯
- **è§£å†³**: æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ï¼Œè”ç³»æŠ€æœ¯æ”¯æŒ

#### 50002 - æ•°æ®åº“æ“ä½œå¤±è´¥
- **åŸå› **: MySQL æ•°æ®åº“åˆ›å»ºã€ç”¨æˆ·åˆ›å»ºæˆ–æƒé™åˆ†é…å¤±è´¥
- **è§£å†³**: æ£€æŸ¥ MySQL æœåŠ¡çŠ¶æ€å’Œç®¡ç†å‘˜æƒé™

## ğŸ› ï¸ å¼€å‘å·¥å…·

### Swagger UI
è®¿é—® `http://localhost:3000/swagger-ui/` å¯ä»¥ï¼š
- æŸ¥çœ‹å®Œæ•´çš„ API æ–‡æ¡£
- åœ¨çº¿æµ‹è¯• API æ¥å£
- æŸ¥çœ‹è¯·æ±‚/å“åº”ç¤ºä¾‹
- ä¸‹è½½ OpenAPI è§„èŒƒæ–‡ä»¶

### API æµ‹è¯•
æ¨èä½¿ç”¨ä»¥ä¸‹å·¥å…·æµ‹è¯• APIï¼š
- **curl**: å‘½ä»¤è¡Œå·¥å…·
- **Postman**: å›¾å½¢åŒ– API æµ‹è¯•å·¥å…·
- **HTTPie**: ç°ä»£åŒ–çš„å‘½ä»¤è¡Œ HTTP å®¢æˆ·ç«¯

### ç¤ºä¾‹é›†åˆ

**Postman é›†åˆç¤ºä¾‹**
```json
{
  "info": {
    "name": "DormDB API",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "ç”³è¯·æ•°æ®åº“",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"identity_key\": \"test_user_001\"}"
        },
        "url": {
          "raw": "{{base_url}}/api/v1/apply",
          "host": ["{{base_url}}"],
          "path": ["api", "v1", "apply"]
        }
      }
    }
  ]
}
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **èº«ä»½æ ‡è¯†å”¯ä¸€æ€§**: æ¯ä¸ªèº«ä»½æ ‡è¯†åªèƒ½ç”³è¯·ä¸€æ¬¡æ•°æ®åº“
2. **å¯†ç å®‰å…¨**: è¿”å›çš„å¯†ç æ˜¯ä¸€æ¬¡æ€§æ˜¾ç¤ºï¼Œè¯·å¦¥å–„ä¿å­˜
3. **æƒé™é™åˆ¶**: åˆ›å»ºçš„æ•°æ®åº“ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®åº“
4. **è¿æ¥é™åˆ¶**: æ•°æ®åº“è¿æ¥å—åˆ°ä¸»æœºé™åˆ¶ï¼Œé€šå¸¸åªå…è®¸ä»æŒ‡å®šä¸»æœºè¿æ¥
5. **ç®¡ç†å‘˜æ¥å£**: ç®¡ç†å‘˜æ¥å£åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åº”è¯¥æ·»åŠ èº«ä»½éªŒè¯

## ğŸ”— ç›¸å…³é“¾æ¥

- **é¡¹ç›®ä¸»é¡µ**: http://localhost:3000
- **ç®¡ç†ç•Œé¢**: http://localhost:3000/admin.html
- **API æ–‡æ¡£**: http://localhost:3000/swagger-ui/
- **GitHub ä»“åº“**: [é¡¹ç›®åœ°å€]
- **æŠ€æœ¯æ–‡æ¡£**: [PROJECT_DESCRIPTION.md](PROJECT_DESCRIPTION.md)
