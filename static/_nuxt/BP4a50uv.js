const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BnL1Hu2L.js","./BwY6AjUB.js","./DMe3A4Sv.js"])))=>i.map(i=>d[i]);
import{g as B,r as b,j as w,k as S,s as V,l as I,m as T,n as N,p as R,c as k,a as t,q as C,v as E,x as L,y as P,z as s,A as M,t as i,B as U,d as D,b as d,w as q,C as J,o as y}from"./DMe3A4Sv.js";import{_ as z}from"./BCfF5pEf.js";import{c as O,v as F}from"./BwY6AjUB.js";const G=B("application",()=>{const g=b(null),c=b(!1),p=b(null),v=async _=>{c.value=!0,p.value=null;try{const{apiClient:l}=await S(async()=>{const{apiClient:x}=await import("./BnL1Hu2L.js");return{apiClient:x}},__vite__mapDeps([0,1,2]),import.meta.url),a=await l.applyDatabase(_);return g.value=a,a}catch(l){throw p.value=l.message||"申请数据库失败",l}finally{c.value=!1}},h=()=>{g.value=null,p.value=null};return{currentApplication:w(g),loading:w(c),error:w(p),applyDatabase:v,clearApplication:h}}),H={class:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8"},K={class:"max-w-md mx-auto"},Q={class:"card p-6"},W={key:0,class:"alert alert-error"},X=["disabled"],Y={key:0,class:"mt-8 p-4 bg-green-50 rounded-lg border border-green-200"},Z={class:"space-y-3"},tt={class:"flex justify-between items-center"},et={class:"flex items-center gap-2"},st={class:"text-sm text-gray-900"},ot={class:"flex justify-between items-center"},nt={class:"flex items-center gap-2"},lt={class:"text-sm text-gray-900"},at={class:"flex justify-between items-center"},rt={class:"flex items-center gap-2"},it={class:"text-sm text-gray-900"},dt={class:"flex justify-between items-center"},ct={class:"flex items-center gap-2"},ut={class:"text-sm text-gray-900"},mt={class:"flex justify-between items-center"},pt={class:"flex items-center gap-2"},xt={class:"text-sm text-gray-900 font-mono"},bt={class:"pt-4 border-t border-green-200"},vt={class:"flex items-center gap-2"},gt={class:"flex-1 text-xs bg-gray-100 p-2 rounded border text-gray-800 break-all"},_t={class:"pt-2"},ft={class:"flex items-center gap-2"},yt={class:"flex-1 text-xs bg-gray-100 p-2 rounded border text-gray-800 break-all"},ht={class:"mt-6 text-center"},Dt={__name:"index",setup(g){const c=G(),{currentApplication:p,loading:v,error:h}=V(c),{success:_,error:l}=I(),a=b(""),x=b(!1),f=b(""),o=T(()=>c.currentApplication),A=async()=>{f.value="";const r=F(a.value);if(!r.valid){f.value=r.message,l(r.message);return}try{await c.applyDatabase(a.value),p.value&&(_("数据库申请成功！"),a.value="")}catch{l("申请失败，请重试")}},m=async(r,e)=>{try{await O(r),_(`${e}已复制到剪贴板`)}catch{l("复制失败，请手动复制")}},$=()=>{x.value=!x.value};return N(h,r=>{r&&l(r)}),R(()=>{c.clearApplication()}),(r,e)=>{const n=J,j=z;return y(),k("div",H,[t("div",K,[e[20]||(e[20]=t("div",{class:"text-center"},[t("h1",{class:"text-3xl font-bold text-gray-900 mb-2"},"DormDB"),t("p",{class:"text-gray-600 mb-8"},"数据库申请平台")],-1)),t("div",Q,[t("form",{onSubmit:E(A,["prevent"]),class:"space-y-6"},[t("div",null,[e[8]||(e[8]=t("label",{for:"studentId",class:"form-label"},"学号",-1)),L(t("input",{id:"studentId","onUpdate:modelValue":e[0]||(e[0]=u=>M(a)?a.value=u:null),type:"text",class:"form-input",placeholder:"请输入10位学号，例如：2023010101",pattern:"\\d{10}",maxlength:"10",required:""},null,512),[[P,s(a)]]),e[9]||(e[9]=t("p",{class:"mt-1 text-sm text-gray-500"}," 请输入10位数字学号 ",-1))]),s(f)?(y(),k("div",W,i(s(f)),1)):C("",!0),t("button",{type:"submit",class:"btn btn-primary w-full",disabled:s(v)},[s(v)?(y(),U(n,{key:0,name:"svg-spinners:90-ring",class:"mr-2"})):C("",!0),D(" "+i(s(v)?"申请中...":"申请数据库"),1)],8,X)],32),s(o)?(y(),k("div",Y,[e[18]||(e[18]=t("h3",{class:"text-lg font-semibold text-green-800 mb-4"},"申请成功！",-1)),t("div",Z,[t("div",tt,[e[10]||(e[10]=t("span",{class:"text-sm font-medium text-gray-700"},"主机:",-1)),t("div",et,[t("span",st,i(s(o).db_host),1),t("button",{onClick:e[1]||(e[1]=u=>m(s(o).db_host,"主机地址")),class:"text-blue-600 hover:text-blue-800"},[d(n,{name:"heroicons:clipboard-document",class:"w-4 h-4"})])])]),t("div",ot,[e[11]||(e[11]=t("span",{class:"text-sm font-medium text-gray-700"},"端口:",-1)),t("div",nt,[t("span",lt,i(s(o).db_port),1),t("button",{onClick:e[2]||(e[2]=u=>m(s(o).db_port.toString(),"端口号")),class:"text-blue-600 hover:text-blue-800"},[d(n,{name:"heroicons:clipboard-document",class:"w-4 h-4"})])])]),t("div",at,[e[12]||(e[12]=t("span",{class:"text-sm font-medium text-gray-700"},"数据库:",-1)),t("div",rt,[t("span",it,i(s(o).db_name),1),t("button",{onClick:e[3]||(e[3]=u=>m(s(o).db_name,"数据库名")),class:"text-blue-600 hover:text-blue-800"},[d(n,{name:"heroicons:clipboard-document",class:"w-4 h-4"})])])]),t("div",dt,[e[13]||(e[13]=t("span",{class:"text-sm font-medium text-gray-700"},"用户名:",-1)),t("div",ct,[t("span",ut,i(s(o).username),1),t("button",{onClick:e[4]||(e[4]=u=>m(s(o).username,"用户名")),class:"text-blue-600 hover:text-blue-800"},[d(n,{name:"heroicons:clipboard-document",class:"w-4 h-4"})])])]),t("div",mt,[e[14]||(e[14]=t("span",{class:"text-sm font-medium text-gray-700"},"密码:",-1)),t("div",pt,[t("span",xt,i(s(x)?s(o).password:"•".repeat(s(o).password.length)),1),t("button",{onClick:$,class:"text-blue-600 hover:text-blue-800"},[d(n,{name:s(x)?"heroicons:eye-slash":"heroicons:eye",class:"w-4 h-4"},null,8,["name"])]),t("button",{onClick:e[5]||(e[5]=u=>m(s(o).password,"密码")),class:"text-blue-600 hover:text-blue-800"},[d(n,{name:"heroicons:clipboard-document",class:"w-4 h-4"})])])]),t("div",bt,[e[15]||(e[15]=t("label",{class:"text-sm font-medium text-gray-700 block mb-2"},"连接字符串:",-1)),t("div",vt,[t("code",gt,i(s(o).connection_string),1),t("button",{onClick:e[6]||(e[6]=u=>m(s(o).connection_string,"连接字符串")),class:"text-blue-600 hover:text-blue-800 flex-shrink-0"},[d(n,{name:"heroicons:clipboard-document",class:"w-4 h-4"})])])]),t("div",_t,[e[16]||(e[16]=t("label",{class:"text-sm font-medium text-gray-700 block mb-2"},"JDBC URL:",-1)),t("div",ft,[t("code",yt,i(s(o).jdbc_url),1),t("button",{onClick:e[7]||(e[7]=u=>m(s(o).jdbc_url,"JDBC URL")),class:"text-blue-600 hover:text-blue-800 flex-shrink-0"},[d(n,{name:"heroicons:clipboard-document",class:"w-4 h-4"})])])]),e[17]||(e[17]=t("div",{class:"pt-4 text-sm text-green-700"},[t("p",null,[t("strong",null,"提示：")]),t("ul",{class:"mt-2 space-y-1 text-sm"},[t("li",null,"• 请妥善保管您的数据库连接信息"),t("li",null,"• 连接信息将在3秒后自动清除剪贴板"),t("li",null,"• 如有问题请联系管理员")])],-1))])])):C("",!0),t("div",ht,[d(j,{to:"/admin/login",class:"text-sm text-blue-600 hover:text-blue-800"},{default:q(()=>e[19]||(e[19]=[D(" 管理员登录 ")])),_:1,__:[19]})])])])])}}};export{Dt as default};
