import{I as E,r as C,n as U,m as P,J as W,c,o as i,a as e,q as I,x as z,b as v,C as L,K as X,z as l,L as Y,A as K,B as j,M as T,N as A,t as w,O as Z,d as S,H as ee,s as te,l as Q,P as R,y as F,v as q,Q as se,p as oe,w as ne}from"./UuX0VwB7.js";import{_ as ae}from"./C6ijD7c3.js";import{u as H,_ as le}from"./CX-UL3wi.js";import{v as re}from"./f-SsayYv.js";const ie={class:"relative"},de={class:"relative"},ue={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},ce=["type","placeholder","disabled"],me={class:"absolute inset-y-0 right-0 flex items-center"},pe=["disabled"],fe={key:0,class:"absolute z-10 mt-1 w-full bg-white shadow-lg max-h-60 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none"},ge=["onClick"],he={class:"flex items-center"},ye={class:"font-normal block truncate"},be=E({__name:"SearchBox",props:{modelValue:{default:""},placeholder:{default:"æœç´¢..."},type:{default:"text"},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},showClearButton:{type:Boolean,default:!0},showSearchButton:{type:Boolean,default:!1},suggestions:{default:()=>[]},showSuggestions:{type:Boolean,default:!1},debounceMs:{default:300},minLength:{default:0}},emits:["update:modelValue","search","clear","focus","blur","input"],setup(V,{expose:m,emit:d}){const p=V,f=d,h=C(),u=C(p.modelValue),b=C(!1);let r=null;const g=t=>{r&&clearTimeout(r),r=setTimeout(()=>{t.length>=p.minLength&&f("search",t)},p.debounceMs)},k=t=>{const y=t.target.value;u.value=y,f("update:modelValue",y),f("input",y),p.debounceMs>0&&g(y)},$=()=>{u.value.length>=p.minLength&&f("search",u.value)},n=()=>{u.value="",f("update:modelValue",""),f("clear"),f("search",""),Z(()=>{var t;(t=h.value)==null||t.focus()})},o=t=>{b.value=!0,f("focus",t)},_=t=>{setTimeout(()=>{b.value=!1},200),f("blur",t)},a=t=>{u.value=t,f("update:modelValue",t),f("search",t),b.value=!1},N=()=>{var t;(t=h.value)==null||t.focus()},M=()=>{var t;(t=h.value)==null||t.blur()};return U(()=>p.modelValue,t=>{u.value=t}),P(()=>p.showSuggestions&&b.value&&u.value.length>=p.minLength),m({focus:N,blur:M}),W(()=>{r&&clearTimeout(r)}),(t,s)=>{const y=L;return i(),c("div",ie,[e("div",de,[e("div",ue,[v(y,{name:"heroicons:magnifying-glass",class:"h-5 w-5 text-gray-400"})]),z(e("input",{ref_key:"inputRef",ref:h,"onUpdate:modelValue":s[0]||(s[0]=B=>K(u)?u.value=B:null),type:t.type,placeholder:t.placeholder,disabled:t.disabled,class:"block w-full pl-10 pr-10 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed",onKeyup:Y($,["enter"]),onInput:k,onFocus:o,onBlur:_},null,40,ce),[[X,l(u)]]),e("div",me,[l(u)&&t.showClearButton?(i(),c("button",{key:0,onClick:n,class:"p-1 mr-1 text-gray-400 hover:text-gray-600 focus:outline-none",type:"button"},[v(y,{name:"heroicons:x-mark",class:"h-4 w-4"})])):I("",!0),t.showSearchButton?(i(),c("button",{key:1,onClick:$,disabled:t.disabled||t.loading,class:"p-1 mr-2 text-gray-400 hover:text-gray-600 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed",type:"button"},[t.loading?(i(),j(y,{key:0,name:"svg-spinners:90-ring",class:"h-4 w-4"})):(i(),j(y,{key:1,name:"heroicons:magnifying-glass",class:"h-4 w-4"}))],8,pe)):I("",!0)])]),t.showSuggestions&&t.suggestions.length>0?(i(),c("div",fe,[(i(!0),c(T,null,A(t.suggestions,(B,D)=>(i(),c("div",{key:D,onClick:O=>a(B),class:"cursor-pointer select-none relative py-2 pl-3 pr-9 hover:bg-gray-50"},[e("div",he,[e("span",ye,w(B),1)])],8,ge))),128))])):I("",!0)])}}}),xe={class:"flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6"},ve={class:"flex flex-1 justify-between sm:hidden"},_e=["disabled"],we=["disabled"],ke={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},$e={class:"text-sm text-gray-700"},Ce={class:"font-medium"},Pe={class:"font-medium"},Se={class:"font-medium"},Ie={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},Be=["disabled"],Ve=["onClick"],Ne={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700 ring-1 ring-inset ring-gray-300 focus:outline-offset-0"},ze=["disabled"],Te=E({__name:"Pagination",props:{currentPage:{},totalPages:{},total:{},perPage:{},showSizeChanger:{type:Boolean,default:!1},pageSizeOptions:{default:()=>[10,20,50,100]}},emits:["update:currentPage","update:perPage","change"],setup(V,{emit:m}){const d=V,p=m,f=P(()=>(d.currentPage-1)*d.perPage+1),h=P(()=>Math.min(d.currentPage*d.perPage,d.total)),u=P(()=>d.currentPage>1),b=P(()=>d.currentPage<d.totalPages),r=P(()=>{const n=[],o=d.totalPages,_=d.currentPage;if(o<=7)for(let a=1;a<=o;a++)n.push(a);else if(n.push(1),_<=4){for(let a=2;a<=5;a++)n.push(a);n.push("..."),n.push(o)}else if(_>=o-3){n.push("...");for(let a=o-4;a<=o;a++)n.push(a)}else{n.push("...");for(let a=_-1;a<=_+1;a++)n.push(a);n.push("..."),n.push(o)}return n}),g=n=>{n>=1&&n<=d.totalPages&&n!==d.currentPage&&(p("update:currentPage",n),p("change",n,d.perPage))},k=()=>{u.value&&g(d.currentPage-1)},$=()=>{b.value&&g(d.currentPage+1)};return(n,o)=>{const _=L;return i(),c("div",xe,[e("div",ve,[e("button",{onClick:k,disabled:!l(u),class:"relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," ä¸Šä¸€é¡µ ",8,_e),e("button",{onClick:$,disabled:!l(b),class:"relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," ä¸‹ä¸€é¡µ ",8,we)]),e("div",ke,[e("div",null,[e("p",$e,[o[0]||(o[0]=S(" æ˜¾ç¤ºç¬¬ ")),e("span",Ce,w(l(f)),1),o[1]||(o[1]=S(" åˆ° ")),e("span",Pe,w(l(h)),1),o[2]||(o[2]=S(" é¡¹ï¼Œå…± ")),e("span",Se,w(n.total),1),o[3]||(o[3]=S(" é¡¹ "))])]),e("div",null,[e("nav",Ie,[e("button",{onClick:k,disabled:!l(u),class:"relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50 disabled:cursor-not-allowed"},[o[4]||(o[4]=e("span",{class:"sr-only"},"ä¸Šä¸€é¡µ",-1)),v(_,{name:"heroicons:chevron-left",class:"h-5 w-5"})],8,Be),(i(!0),c(T,null,A(l(r),a=>(i(),c(T,{key:a},[a!=="..."?(i(),c("button",{key:0,onClick:N=>g(a),class:ee([a===n.currentPage?"relative z-10 inline-flex items-center bg-blue-600 px-4 py-2 text-sm font-semibold text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600":"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0"])},w(a),11,Ve)):(i(),c("span",Ne," ... "))],64))),128)),e("button",{onClick:$,disabled:!l(b),class:"relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50 disabled:cursor-not-allowed"},[o[5]||(o[5]=e("span",{class:"sr-only"},"ä¸‹ä¸€é¡µ",-1)),v(_,{name:"heroicons:chevron-right",class:"h-5 w-5"})],8,ze)])])])])}}}),Le={key:0,class:"alert alert-error"},Me={class:"flex justify-end space-x-3 pt-4"},De=["disabled"],Fe={__name:"AddStudentForm",emits:["close","success"],setup(V,{emit:m}){const d=m,p=H(),{loading:f,error:h}=te(p),{success:u,error:b}=Q(),r=R({studentId:"",name:"",className:""}),g=R({studentId:"",name:"",className:""}),k=()=>{Object.keys(g).forEach(o=>{g[o]=""});let n=!0;if(!r.studentId)g.studentId="è¯·è¾“å…¥å­¦å·",n=!1;else{const o=re(r.studentId);o.valid||(g.studentId=o.message,n=!1)}return r.name.trim()||(g.name="è¯·è¾“å…¥å§“å",n=!1),r.className.trim()||(g.className="è¯·è¾“å…¥ç­çº§",n=!1),n},$=async()=>{if(console.log("ðŸš€ å¼€å§‹æäº¤è¡¨å•"),console.log("ðŸ“ è¡¨å•æ•°æ®:",r),!k()){console.log("âŒ è¡¨å•éªŒè¯å¤±è´¥");return}const n={student_id:r.studentId,student_name:r.name,class_info:r.className};console.log("ðŸ“¤ å‡†å¤‡å‘é€çš„æ•°æ®:",n);try{console.log("ðŸ”„ è°ƒç”¨ studentStore.addStudent"),await p.addStudent(n),console.log("âœ… æ·»åŠ å­¦ç”ŸæˆåŠŸ"),u(`å­¦ç”Ÿ ${r.name} (${r.studentId}) æ·»åŠ æˆåŠŸ`),Object.assign(r,{studentId:"",name:"",className:""}),d("success"),d("close")}catch(o){console.error("ðŸ’¥ æ·»åŠ å­¦ç”Ÿå¤±è´¥:",o),b(`æ·»åŠ å­¦ç”Ÿå¤±è´¥: ${o.message||"æœªçŸ¥é”™è¯¯"}`)}};return U(h,n=>{n&&b(n)}),(n,o)=>{const _=L;return i(),c("form",{onSubmit:q($,["prevent"]),class:"space-y-4"},[e("div",null,[o[4]||(o[4]=e("label",{for:"studentId",class:"form-label"},"å­¦å·",-1)),z(e("input",{id:"studentId","onUpdate:modelValue":o[0]||(o[0]=a=>l(r).studentId=a),type:"text",class:"form-input",placeholder:"è¯·è¾“å…¥10ä½å­¦å·",pattern:"\\d{10}",maxlength:"10",required:""},null,512),[[F,l(r).studentId]])]),e("div",null,[o[5]||(o[5]=e("label",{for:"studentName",class:"form-label"},"å§“å",-1)),z(e("input",{id:"studentName","onUpdate:modelValue":o[1]||(o[1]=a=>l(r).name=a),type:"text",class:"form-input",placeholder:"è¯·è¾“å…¥å­¦ç”Ÿå§“å",required:""},null,512),[[F,l(r).name]])]),e("div",null,[o[6]||(o[6]=e("label",{for:"classInfo",class:"form-label"},"ç­çº§",-1)),z(e("input",{id:"classInfo","onUpdate:modelValue":o[2]||(o[2]=a=>l(r).className=a),type:"text",class:"form-input",placeholder:"è¯·è¾“å…¥ç­çº§ä¿¡æ¯",required:""},null,512),[[F,l(r).className]])]),l(h)?(i(),c("div",Le,w(l(h)),1)):I("",!0),e("div",Me,[e("button",{type:"button",onClick:o[3]||(o[3]=a=>n.$emit("close")),class:"btn btn-secondary"},"å–æ¶ˆ"),e("button",{type:"submit",class:"btn btn-primary",disabled:l(f)},[l(f)?(i(),j(_,{key:0,name:"svg-spinners:90-ring",class:"w-4 h-4 mr-2"})):I("",!0),S(" "+w(l(f)?"æ·»åŠ ä¸­...":"æ·»åŠ "),1)],8,De)])],32)}}},je={class:"min-h-screen bg-gray-50"},qe={class:"bg-white shadow"},Ue={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},Ae={class:"flex justify-between items-center py-6"},Oe={class:"flex items-center"},Re={class:"flex items-center space-x-4"},Ee={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},Ke={class:"px-4 py-6 sm:px-0"},Qe={class:"mb-6 card p-4"},He={class:"flex flex-col sm:flex-row gap-4"},Je={class:"flex-1"},Ge=["disabled"],We={class:"card"},Xe={class:"overflow-x-auto"},Ye={class:"min-w-full divide-y divide-gray-200"},Ze={class:"bg-white divide-y divide-gray-200"},et={key:0},tt={colspan:"5",class:"px-6 py-4 text-center"},st={key:1},ot={colspan:"5",class:"px-6 py-4 text-center text-red-600"},nt={key:2},at={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},lt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},rt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},it={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},dt={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},ut=["onClick"],ct={key:0,class:"px-6 py-3 border-t border-gray-200"},mt={class:"mt-3"},pt={class:"mt-3"},xt={__name:"students",setup(V){const m=H(),{success:d,error:p}=Q(),{confirmDelete:f}=se(),h=C(""),u=C(!1),b=C(!1),r=C(1),g=C(20),k=P(()=>{if(!h.value)return m.students;const t=h.value.toLowerCase();return m.students.filter(s=>s.student_id.toLowerCase().includes(t)||s.student_name.toLowerCase().includes(t)||s.class_info.toLowerCase().includes(t))}),$=P(()=>Math.ceil(m.total/g.value)),n=t=>{h.value=t,r.value=1},o=t=>{r.value=t,_(t)},_=async t=>{try{const s=(t-1)*g.value;await m.fetchStudents({limit:g.value,offset:s})}catch{p("åŠ è½½æ•°æ®å¤±è´¥")}},a=async()=>{try{await m.fetchStudents({limit:g.value,offset:0}),d("æ•°æ®åˆ·æ–°æˆåŠŸ")}catch{p("åˆ·æ–°æ•°æ®å¤±è´¥")}},N=async(t,s)=>{if(await f(s||t))try{await m.deleteStudent(t),d(`å­¦ç”Ÿ ${s||t} åˆ é™¤æˆåŠŸ`)}catch{p("åˆ é™¤å­¦ç”Ÿå¤±è´¥")}},M=t=>new Date(t).toLocaleString("zh-CN");return U(()=>m.error,t=>{t&&p(t)}),oe(()=>{a()}),(t,s)=>{const y=L,B=ae,D=be,O=Te,J=Fe,G=le;return i(),c("div",je,[e("header",qe,[e("div",Ue,[e("div",Ae,[e("div",Oe,[v(B,{to:"/admin/dashboard",class:"text-blue-600 hover:text-blue-800 mr-4"},{default:ne(()=>[v(y,{name:"heroicons:arrow-left",class:"w-5 h-5"})]),_:1}),s[9]||(s[9]=e("h1",{class:"text-2xl font-bold text-gray-900"},"å­¦å·ç®¡ç†",-1))]),e("div",Re,[e("button",{onClick:s[0]||(s[0]=x=>u.value=!0),class:"btn btn-primary"},[v(y,{name:"heroicons:plus",class:"w-4 h-4 mr-2"}),s[10]||(s[10]=S(" æ·»åŠ å­¦å· "))]),e("button",{onClick:s[1]||(s[1]=x=>b.value=!0),class:"btn btn-secondary"},[v(y,{name:"heroicons:arrow-up-tray",class:"w-4 h-4 mr-2"}),s[11]||(s[11]=S(" æ‰¹é‡å¯¼å…¥ "))])])])])]),e("main",Ee,[e("div",Ke,[e("div",Qe,[e("div",He,[e("div",Je,[v(D,{modelValue:l(h),"onUpdate:modelValue":s[2]||(s[2]=x=>K(h)?h.value=x:null),placeholder:"æœç´¢å­¦å·ã€å§“åæˆ–ç­çº§...","debounce-ms":500,onSearch:n},null,8,["modelValue"])]),e("button",{onClick:a,class:"btn btn-secondary",disabled:l(m).loading},[v(y,{name:"heroicons:arrow-path",class:"w-4 h-4 mr-2"}),s[12]||(s[12]=S(" åˆ·æ–° "))],8,Ge)])]),e("div",We,[e("div",Xe,[e("table",Ye,[s[14]||(s[14]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," å­¦å· "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," å§“å "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," ç­çº§ "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," åˆ›å»ºæ—¶é—´ "),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," æ“ä½œ ")])],-1)),e("tbody",Ze,[l(m).loading?(i(),c("tr",et,[e("td",tt,[v(y,{name:"svg-spinners:90-ring",class:"w-6 h-6 text-blue-600 mx-auto"})])])):l(m).error?(i(),c("tr",st,[e("td",ot,w(l(m).error),1)])):l(k).length===0?(i(),c("tr",nt,s[13]||(s[13]=[e("td",{colspan:"5",class:"px-6 py-4 text-center text-gray-500"},"æš‚æ— å­¦ç”Ÿè®°å½•",-1)]))):(i(!0),c(T,{key:3},A(l(k),x=>(i(),c("tr",{key:x.student_id},[e("td",at,w(x.student_id),1),e("td",lt,w(x.student_name),1),e("td",rt,w(x.class_info),1),e("td",it,w(M(x.created_at)),1),e("td",dt,[e("button",{onClick:ft=>N(x.student_id,x.student_name),class:"text-red-600 hover:text-red-900"},[v(y,{name:"heroicons:trash",class:"w-4 h-4"})],8,ut)])]))),128))])])]),l(m).total>0?(i(),c("div",ct,[v(O,{"current-page":l(r),"total-pages":l($),total:l(m).total,"per-page":l(g),onChange:o},null,8,["current-page","total-pages","total","per-page"])])):I("",!0)])])]),l(u)?(i(),c("div",{key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",onClick:s[5]||(s[5]=x=>u.value=!1)},[e("div",{class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",onClick:s[4]||(s[4]=q(()=>{},["stop"]))},[e("div",mt,[s[15]||(s[15]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"æ·»åŠ å­¦å·",-1)),v(J,{onClose:s[3]||(s[3]=x=>u.value=!1),onSuccess:a})])])])):I("",!0),l(b)?(i(),c("div",{key:1,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",onClick:s[8]||(s[8]=x=>b.value=!1)},[e("div",{class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",onClick:s[7]||(s[7]=q(()=>{},["stop"]))},[e("div",pt,[s[16]||(s[16]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"æ‰¹é‡å¯¼å…¥å­¦å·",-1)),v(G,{onClose:s[6]||(s[6]=x=>b.value=!1),onSuccess:a})])])])):I("",!0)])}}};export{xt as default};
