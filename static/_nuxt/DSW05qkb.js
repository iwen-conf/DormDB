const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BnL1Hu2L.js","./BwY6AjUB.js","./DMe3A4Sv.js"])))=>i.map(i=>d[i]);
import{g as V,r as l,j as S,k as g,l as E,c as m,o as i,a as o,q as x,x as h,y as D,z as r,A as k,Q as T,t as C,J as B,K as R,B as A,d as L,C as P}from"./DMe3A4Sv.js";const O=V("students",()=>{const p=l([]),f=l(0),_=l(!1),y=l(null),w=async(a=100,e=0)=>{_.value=!0,y.value=null;try{const{apiClient:n}=await g(async()=>{const{apiClient:t}=await import("./BnL1Hu2L.js");return{apiClient:t}},__vite__mapDeps([0,1,2]),import.meta.url),s=await n.getStudentIds(a,e);p.value=s.students,f.value=s.total}catch(n){y.value=n.message||"获取学生列表失败"}finally{_.value=!1}},b=async(a,e,n)=>{try{const{apiClient:s}=await g(async()=>{const{apiClient:t}=await import("./BnL1Hu2L.js");return{apiClient:t}},__vite__mapDeps([0,1,2]),import.meta.url);await s.addStudentId(a,e,n),await w()}catch(s){throw s}},u=async a=>{try{const{apiClient:e}=await g(async()=>{const{apiClient:n}=await import("./BnL1Hu2L.js");return{apiClient:n}},__vite__mapDeps([0,1,2]),import.meta.url);await e.deleteStudentId(a),p.value=p.value.filter(n=>n.student_id!==a),f.value--}catch(e){throw e}},v=async(a,e=!1)=>{try{const{apiClient:n}=await g(async()=>{const{apiClient:t}=await import("./BnL1Hu2L.js");return{apiClient:t}},__vite__mapDeps([0,1,2]),import.meta.url),s=await n.batchImportStudentIds(a,e);return await w(),s}catch(n){throw n}},c=a=>p.value.find(e=>e.student_id===a);return{students:S(p),total:S(f),loading:S(_),error:S(y),fetchStudents:w,addStudent:b,deleteStudent:u,batchImport:v,findStudent:c}}),$={class:"space-y-4"},N={class:"flex items-center"},j={key:0,class:"alert alert-error"},M={key:1,class:"alert alert-success"},U={key:0},q={key:1,class:"mt-2"},z={class:"mt-1 text-sm"},F={class:"flex justify-end space-x-3 pt-4"},J=["disabled"],Q={__name:"BatchImport",emits:["close","success"],setup(p,{emit:f}){const _=f,y=O(),{success:w,error:b}=E(),u=l(""),v=l(!1),c=l(!1),a=l(""),e=l(null),n=async()=>{if(!u.value.trim()){a.value="请输入CSV数据",b("请输入CSV数据");return}c.value=!0,a.value="",e.value=null;try{const s=await y.batchImport(u.value,v.value);e.value=s,s.success_count>0&&(w(`成功导入 ${s.success_count} 条记录`),_("success"),s.failed_count===0&&setTimeout(()=>{_("close")},2e3)),s.failed_count>0&&b(`${s.failed_count} 条记录导入失败`)}catch(s){a.value=s.message||"导入失败",b("批量导入失败")}finally{c.value=!1}};return(s,t)=>{const I=P;return i(),m("div",$,[o("div",null,[t[3]||(t[3]=o("label",{for:"csvData",class:"form-label"},"CSV 数据",-1)),h(o("textarea",{id:"csvData","onUpdate:modelValue":t[0]||(t[0]=d=>k(u)?u.value=d:null),rows:"8",class:"form-input",placeholder:`请输入CSV格式数据，格式：学号,姓名,班级
例如：
2023010101,张三,计算机科学与技术1班
2023010102,李四,计算机科学与技术1班`},null,512),[[D,r(u)]]),t[4]||(t[4]=o("p",{class:"mt-1 text-sm text-gray-500"}," 格式：学号,姓名,班级（每行一个学生） ",-1))]),o("div",N,[h(o("input",{id:"overwrite","onUpdate:modelValue":t[1]||(t[1]=d=>k(v)?v.value=d:null),type:"checkbox",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,512),[[T,r(v)]]),t[5]||(t[5]=o("label",{for:"overwrite",class:"ml-2 block text-sm text-gray-900"}," 覆盖已存在的学号 ",-1))]),r(a)?(i(),m("div",j,C(r(a)),1)):x("",!0),r(e)?(i(),m("div",M,[t[7]||(t[7]=o("p",null,"导入完成！",-1)),o("p",null,"成功导入："+C(r(e).success_count)+" 条",1),r(e).failed_count>0?(i(),m("p",U,"失败："+C(r(e).failed_count)+" 条",1)):x("",!0),r(e).errors.length>0?(i(),m("div",q,[t[6]||(t[6]=o("p",{class:"font-medium"},"错误详情：",-1)),o("ul",z,[(i(!0),m(B,null,R(r(e).errors,d=>(i(),m("li",{key:d},"• "+C(d),1))),128))])])):x("",!0)])):x("",!0),o("div",F,[o("button",{type:"button",onClick:t[2]||(t[2]=d=>s.$emit("close")),class:"btn btn-secondary"}," 取消 "),o("button",{type:"button",onClick:n,class:"btn btn-primary",disabled:r(c)||!r(u).trim()},[r(c)?(i(),A(I,{key:0,name:"svg-spinners:90-ring",class:"w-4 h-4 mr-2"})):x("",!0),L(" "+C(r(c)?"导入中...":"开始导入"),1)],8,J)])])}}};export{Q as _,O as u};
