const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CHvCcL-2.js","./f-SsayYv.js","./UuX0VwB7.js"])))=>i.map(i=>d[i]);
import{g as O,r as d,j as _,k as c,s as B,D as U,l as N,n as V,c as x,a as t,q as E,H as I,z as i,t as l,b as n,d as L,w as $,v as j,o as h,C as z,G as H}from"./UuX0VwB7.js";import{_ as q}from"./C6ijD7c3.js";import{u as M,_ as G}from"./CX-UL3wi.js";const Q=O("system",()=>{const S=d(null),o=d(null),D=d([]),b=d([]),C=d([]),v=d(!1),r=d(null),k=async()=>{v.value=!0,r.value=null;try{const{apiClient:e}=await c(async()=>{const{apiClient:s}=await import("./CHvCcL-2.js");return{apiClient:s}},__vite__mapDeps([0,1,2]),import.meta.url);S.value=await e.getSystemStatus()}catch(e){r.value=e.message||"获取系统状态失败"}finally{v.value=!1}},p=async()=>{try{const{apiClient:e}=await c(async()=>{const{apiClient:s}=await import("./CHvCcL-2.js");return{apiClient:s}},__vite__mapDeps([0,1,2]),import.meta.url);o.value=await e.getApplicationStats()}catch(e){r.value=e.message||"获取申请统计失败"}},m=async()=>{try{const{apiClient:e}=await c(async()=>{const{apiClient:s}=await import("./CHvCcL-2.js");return{apiClient:s}},__vite__mapDeps([0,1,2]),import.meta.url);D.value=await e.getAllApplicants()}catch(e){r.value=e.message||"获取申请者列表失败"}},g=async()=>{try{const{apiClient:e}=await c(async()=>{const{apiClient:s}=await import("./CHvCcL-2.js");return{apiClient:s}},__vite__mapDeps([0,1,2]),import.meta.url);b.value=await e.getAllUsers()}catch(e){r.value=e.message||"获取用户列表失败"}},u=async()=>{try{const{apiClient:e}=await c(async()=>{const{apiClient:s}=await import("./CHvCcL-2.js");return{apiClient:s}},__vite__mapDeps([0,1,2]),import.meta.url);C.value=await e.getPublicApplications()}catch(e){r.value=e.message||"获取公开申请记录失败"}},f=async(e,s)=>{try{const{apiClient:a}=await c(async()=>{const{apiClient:w}=await import("./CHvCcL-2.js");return{apiClient:w}},__vite__mapDeps([0,1,2]),import.meta.url);await a.deleteUser(e,s),await g()}catch(a){throw a}},y=async(e,s)=>{try{const{apiClient:a}=await c(async()=>{const{apiClient:w}=await import("./CHvCcL-2.js");return{apiClient:w}},__vite__mapDeps([0,1,2]),import.meta.url);await a.adminDeleteUser(e,s),await Promise.all([m(),g(),p()])}catch(a){throw a}},A=async()=>{try{const{apiClient:e}=await c(async()=>{const{apiClient:a}=await import("./CHvCcL-2.js");return{apiClient:a}},__vite__mapDeps([0,1,2]),import.meta.url),s=await e.checkAndRepairConsistency();return await Promise.all([k(),p(),m(),g()]),s}catch(e){throw e}},P=async()=>{try{const{apiClient:e}=await c(async()=>{const{apiClient:s}=await import("./CHvCcL-2.js");return{apiClient:s}},__vite__mapDeps([0,1,2]),import.meta.url);return await e.healthCheck(),!0}catch{return!1}};return{status:_(S),stats:_(o),applicants:_(D),users:_(b),publicApplications:_(C),loading:_(v),error:_(r),fetchStatus:k,fetchStats:p,fetchApplicants:m,fetchUsers:g,fetchPublicApplications:u,deleteUser:f,adminDeleteUser:y,repairConsistency:A,healthCheck:P}}),F={class:"min-h-screen bg-gray-50"},J={class:"bg-white shadow"},K={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},W={class:"flex justify-between items-center py-6"},X={class:"flex items-center"},Y={class:"ml-4 flex items-center"},Z={class:"text-sm text-gray-600"},tt={class:"flex items-center space-x-4"},st=["disabled"],et={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},at={class:"px-4 py-6 sm:px-0"},ot={class:"mb-8"},it={key:0,class:"flex justify-center py-8"},nt={key:1,class:"alert alert-error"},lt={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},rt={class:"card p-6"},ct={class:"flex items-center"},dt={class:"flex-shrink-0"},mt={class:"ml-5 w-0 flex-1"},ut={class:"text-3xl font-bold text-gray-900"},_t={class:"card p-6"},xt={class:"flex items-center"},ht={class:"flex-shrink-0"},pt={class:"ml-5 w-0 flex-1"},gt={class:"text-3xl font-bold text-gray-900"},ft={class:"card p-6"},vt={class:"flex items-center"},yt={class:"flex-shrink-0"},wt={class:"ml-5 w-0 flex-1"},bt={class:"text-lg font-bold text-gray-900"},Ct={class:"card p-6"},kt={class:"flex items-center"},At={class:"flex-shrink-0"},Et={class:"ml-5 w-0 flex-1"},St={class:"text-lg font-bold text-gray-900"},Dt={key:3,class:"mt-8"},Pt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},Tt={class:"card p-6"},Vt={class:"flex items-center"},It={class:"flex-shrink-0"},Lt={class:"ml-5 w-0 flex-1"},Rt={class:"text-3xl font-bold text-gray-900"},Ot={class:"card p-6"},Bt={class:"flex items-center"},Ut={class:"flex-shrink-0"},Nt={class:"ml-5 w-0 flex-1"},$t={class:"text-3xl font-bold text-gray-900"},jt={class:"card p-6"},zt={class:"flex items-center"},Ht={class:"flex-shrink-0"},qt={class:"ml-5 w-0 flex-1"},Mt={class:"text-3xl font-bold text-gray-900"},Gt={class:"card p-6"},Qt={class:"flex items-center"},Ft={class:"flex-shrink-0"},Jt={class:"ml-5 w-0 flex-1"},Kt={class:"text-3xl font-bold text-gray-900"},Wt={class:"mb-8"},Xt={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Yt={class:"flex items-center"},Zt={class:"flex-shrink-0"},ts={class:"flex items-center"},ss={class:"flex-shrink-0"},es={class:"flex items-center"},as={class:"flex-shrink-0"},os={key:0},is={class:"card p-6"},ns={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ls={class:"text-sm text-gray-900"},rs={class:"text-sm text-gray-900"},cs={class:"text-sm text-gray-900"},ds={class:"mt-3"},xs={__name:"dashboard",setup(S){const o=Q(),{status:D,loading:b,error:C}=B(o),{isAuthenticated:v,isAuthReady:r,logout:k}=U();M();const{success:p,error:m,info:g}=N(),u=d(!0),f=d(!1);V([v,r],([e,s])=>{s&&!e?H("/admin/login"):s&&e&&y()},{immediate:!0});const y=async()=>{try{await Promise.all([o.fetchStatus(),o.fetchStats()]),await A(),p("数据刷新成功")}catch{m("刷新数据失败")}},A=async()=>{try{u.value=await o.healthCheck(),p("系统健康检查完成")}catch{m("健康检查失败")}},P=async()=>{try{await k(),g("已安全退出登录"),window.location.href="/admin/login"}catch{m("退出登录失败")}};return V(C,e=>{e&&m(e)}),(e,s)=>{const a=z,w=q,R=G;return h(),x("div",F,[t("header",J,[t("div",K,[t("div",W,[t("div",X,[s[4]||(s[4]=t("h1",{class:"text-2xl font-bold text-gray-900"},"DormDB 管理面板",-1)),t("div",Y,[t("div",{class:I(["w-2 h-2 rounded-full mr-2",i(u)?"bg-green-500":"bg-red-500"])},null,2),t("span",Z,l(i(u)?"系统正常":"系统异常"),1)])]),t("div",tt,[t("button",{onClick:y,class:"btn btn-secondary",disabled:i(b)},[n(a,{name:"heroicons:arrow-path",class:"w-4 h-4 mr-2"}),s[5]||(s[5]=L(" 刷新 "))],8,st),t("button",{onClick:P,class:"btn btn-secondary"},[n(a,{name:"heroicons:arrow-right-on-rectangle",class:"w-4 h-4 mr-2"}),s[6]||(s[6]=L(" 退出 "))])])])])]),t("main",et,[t("div",at,[t("div",ot,[s[16]||(s[16]=t("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"系统统计",-1)),i(o).loading?(h(),x("div",it,[n(a,{name:"svg-spinners:90-ring",class:"w-8 h-8 text-blue-600"})])):i(o).error?(h(),x("div",nt,l(i(o).error),1)):i(o).status?(h(),x("div",lt,[t("div",rt,[t("div",ct,[t("div",dt,[n(a,{name:"heroicons:document-text",class:"w-8 h-8 text-blue-600"})]),t("div",mt,[t("dl",null,[s[7]||(s[7]=t("dt",{class:"text-sm font-medium text-gray-500 truncate"},"总申请数",-1)),t("dd",ut,l(i(o).status.total_applications),1)])])])]),t("div",_t,[t("div",xt,[t("div",ht,[n(a,{name:"heroicons:calendar-days",class:"w-8 h-8 text-green-600"})]),t("div",pt,[t("dl",null,[s[8]||(s[8]=t("dt",{class:"text-sm font-medium text-gray-500 truncate"},"今日申请",-1)),t("dd",gt,l(i(o).status.today_applications),1)])])])]),t("div",ft,[t("div",vt,[t("div",yt,[n(a,{name:"heroicons:server",class:"w-8 h-8 text-blue-600"})]),t("div",wt,[t("dl",null,[s[9]||(s[9]=t("dt",{class:"text-sm font-medium text-gray-500 truncate"},"数据库状态",-1)),t("dd",bt,l(i(o).status.database_status),1)])])])]),t("div",Ct,[t("div",kt,[t("div",At,[n(a,{name:"heroicons:circle-stack",class:"w-8 h-8 text-green-600"})]),t("div",Et,[t("dl",null,[s[10]||(s[10]=t("dt",{class:"text-sm font-medium text-gray-500 truncate"},"MySQL状态",-1)),t("dd",St,l(i(o).status.mysql_status),1)])])])])])):E("",!0),i(o).stats?(h(),x("div",Dt,[s[15]||(s[15]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"申请统计详情",-1)),t("div",Pt,[t("div",Tt,[t("div",Vt,[t("div",It,[n(a,{name:"heroicons:check-circle",class:"w-8 h-8 text-green-600"})]),t("div",Lt,[t("dl",null,[s[11]||(s[11]=t("dt",{class:"text-sm font-medium text-gray-500 truncate"},"成功申请",-1)),t("dd",Rt,l(i(o).stats.successful_count),1)])])])]),t("div",Ot,[t("div",Bt,[t("div",Ut,[n(a,{name:"heroicons:x-circle",class:"w-8 h-8 text-red-600"})]),t("div",Nt,[t("dl",null,[s[12]||(s[12]=t("dt",{class:"text-sm font-medium text-gray-500 truncate"},"失败申请",-1)),t("dd",$t,l(i(o).stats.failed_count),1)])])])]),t("div",jt,[t("div",zt,[t("div",Ht,[n(a,{name:"heroicons:trash",class:"w-8 h-8 text-gray-600"})]),t("div",qt,[t("dl",null,[s[13]||(s[13]=t("dt",{class:"text-sm font-medium text-gray-500 truncate"},"已删除",-1)),t("dd",Mt,l(i(o).stats.deleted_count),1)])])])]),t("div",Gt,[t("div",Qt,[t("div",Ft,[n(a,{name:"heroicons:calendar",class:"w-8 h-8 text-purple-600"})]),t("div",Jt,[t("dl",null,[s[14]||(s[14]=t("dt",{class:"text-sm font-medium text-gray-500 truncate"},"本月申请",-1)),t("dd",Kt,l(i(o).stats.month_count),1)])])])])])])):E("",!0)]),t("div",Wt,[s[20]||(s[20]=t("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"快速操作",-1)),t("div",Xt,[n(w,{to:"/admin/students",class:"card p-6 hover:shadow-lg transition-shadow"},{default:$(()=>[t("div",Yt,[t("div",Zt,[n(a,{name:"heroicons:users",class:"w-8 h-8 text-blue-600"})]),s[17]||(s[17]=t("div",{class:"ml-4"},[t("h3",{class:"text-lg font-medium text-gray-900"},"学号管理"),t("p",{class:"text-sm text-gray-500"},"管理学生学号白名单")],-1))])]),_:1}),t("button",{onClick:s[0]||(s[0]=T=>f.value=!0),class:"card p-6 hover:shadow-lg transition-shadow text-left"},[t("div",ts,[t("div",ss,[n(a,{name:"heroicons:arrow-up-tray",class:"w-8 h-8 text-green-600"})]),s[18]||(s[18]=t("div",{class:"ml-4"},[t("h3",{class:"text-lg font-medium text-gray-900"},"批量导入"),t("p",{class:"text-sm text-gray-500"},"批量导入学生学号")],-1))])]),t("button",{onClick:A,class:"card p-6 hover:shadow-lg transition-shadow text-left"},[t("div",es,[t("div",as,[n(a,{name:"heroicons:heart",class:"w-8 h-8 text-red-600"})]),s[19]||(s[19]=t("div",{class:"ml-4"},[t("h3",{class:"text-lg font-medium text-gray-900"},"健康检查"),t("p",{class:"text-sm text-gray-500"},"检查系统运行状态")],-1))])])])]),i(o).status?(h(),x("div",os,[s[24]||(s[24]=t("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"系统信息",-1)),t("div",is,[t("div",ns,[t("div",null,[s[21]||(s[21]=t("dt",{class:"text-sm font-medium text-gray-500"},"系统版本",-1)),t("dd",ls,l(i(o).status.version),1)]),t("div",null,[s[22]||(s[22]=t("dt",{class:"text-sm font-medium text-gray-500"},"运行状态",-1)),t("dd",rs,l(i(o).status.uptime),1)]),t("div",null,[s[23]||(s[23]=t("dt",{class:"text-sm font-medium text-gray-500"},"系统健康",-1)),t("dd",cs,[t("span",{class:I(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",i(u)?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},l(i(u)?"正常运行":"异常"),3)])])])])])):E("",!0)])]),i(f)?(h(),x("div",{key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",onClick:s[3]||(s[3]=T=>f.value=!1)},[t("div",{class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",onClick:s[2]||(s[2]=j(()=>{},["stop"]))},[t("div",ds,[s[25]||(s[25]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"批量导入学号",-1)),n(R,{onClose:s[1]||(s[1]=T=>f.value=!1),onSuccess:y})])])])):E("",!0)])}}};export{xs as default};
