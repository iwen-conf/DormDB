const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CHvCcL-2.js","./f-SsayYv.js","./UuX0VwB7.js"])))=>i.map(i=>d[i]);
import{g as V,r as o,j as C,k as g,l as E,c as v,o as m,a as s,q as b,x as I,y as D,z as a,A as k,R as P,t as S,M as T,N as A,B as R,d as B,C as L}from"./UuX0VwB7.js";const N=V("students",()=>{const y=o([]),h=o(null),i=o(!1),u=o(null),f=async e=>{i.value=!0,u.value=null;try{const{apiClient:t}=await g(async()=>{const{apiClient:n}=await import("./CHvCcL-2.js");return{apiClient:n}},__vite__mapDeps([0,1,2]),import.meta.url),l=await t.getStudentIds(e);y.value=l}catch(t){u.value=t.message||"获取学生列表失败"}finally{i.value=!1}},c=async()=>{try{const{apiClient:e}=await g(async()=>{const{apiClient:t}=await import("./CHvCcL-2.js");return{apiClient:t}},__vite__mapDeps([0,1,2]),import.meta.url);h.value=await e.getStudentIdStats()}catch(e){u.value=e.message||"获取统计信息失败"}},d=async e=>{i.value=!0,u.value=null;try{const{apiClient:t}=await g(async()=>{const{apiClient:l}=await import("./CHvCcL-2.js");return{apiClient:l}},__vite__mapDeps([0,1,2]),import.meta.url);await t.addStudentId(e),await Promise.all([f(),c()])}catch(t){throw u.value=t.message||"添加学生失败",t}finally{i.value=!1}},w=async e=>{try{const{apiClient:t}=await g(async()=>{const{apiClient:n}=await import("./CHvCcL-2.js");return{apiClient:n}},__vite__mapDeps([0,1,2]),import.meta.url),l=await t.batchImportStudentIds(e);return await Promise.all([f(),c()]),l}catch(t){throw t}},p=e=>y.value.find(t=>t.student_id===e),_=()=>y.value.filter(e=>e.has_applied),r=()=>y.value.filter(e=>!e.has_applied),x=async e=>{try{const{apiClient:t}=await g(async()=>{const{apiClient:l}=await import("./CHvCcL-2.js");return{apiClient:l}},__vite__mapDeps([0,1,2]),import.meta.url);await t.deleteStudentId(e),await Promise.all([f(),c()])}catch(t){throw t}};return{students:C(y),stats:C(h),loading:C(i),error:C(u),fetchStudents:f,fetchStats:c,addStudent:d,batchImport:w,deleteStudent:x,findStudent:p,getAppliedStudents:_,getNotAppliedStudents:r}}),O={class:"space-y-4"},$={class:"flex items-center"},M={key:0,class:"alert alert-error"},j={key:1,class:"alert alert-success"},U={key:0},q={key:1,class:"mt-2"},z={class:"mt-1 text-sm"},F={class:"flex justify-end space-x-3 pt-4"},G=["disabled"],J={__name:"BatchImport",emits:["close","success"],setup(y,{emit:h}){const i=h,u=N(),{success:f,error:c}=E(),d=o(""),w=o(!1),p=o(!1),_=o(""),r=o(null),x=async()=>{if(!d.value.trim()){_.value="请输入CSV数据",c("请输入CSV数据");return}p.value=!0,_.value="",r.value=null;try{const e=await u.batchImport({student_data:d.value,overwrite_existing:w.value});r.value=e,e.imported_count>0&&(f(`成功导入 ${e.imported_count} 条记录`),i("success"),e.errors.length===0&&setTimeout(()=>{i("close")},2e3)),e.failed_count>0&&c(`${e.failed_count} 条记录导入失败`)}catch(e){_.value=e.message||"导入失败",c("批量导入失败")}finally{p.value=!1}};return(e,t)=>{const l=L;return m(),v("div",O,[s("div",null,[t[3]||(t[3]=s("label",{for:"csvData",class:"form-label"},"CSV 数据",-1)),I(s("textarea",{id:"csvData","onUpdate:modelValue":t[0]||(t[0]=n=>k(d)?d.value=n:null),rows:"8",class:"form-input",placeholder:`请输入CSV格式数据，格式：学号,姓名,班级
例如：
2023010101,张三,计算机科学与技术1班
2023010102,李四,计算机科学与技术1班`},null,512),[[D,a(d)]]),t[4]||(t[4]=s("p",{class:"mt-1 text-sm text-gray-500"},"格式：学号,姓名,班级（每行一个学生）",-1))]),s("div",$,[I(s("input",{id:"overwrite","onUpdate:modelValue":t[1]||(t[1]=n=>k(w)?w.value=n:null),type:"checkbox",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,512),[[P,a(w)]]),t[5]||(t[5]=s("label",{for:"overwrite",class:"ml-2 block text-sm text-gray-900"}," 覆盖已存在的学号 ",-1))]),a(_)?(m(),v("div",M,S(a(_)),1)):b("",!0),a(r)?(m(),v("div",j,[t[7]||(t[7]=s("p",null,"导入完成！",-1)),s("p",null,"成功导入："+S(a(r).success_count)+" 条",1),a(r).failed_count>0?(m(),v("p",U,"失败："+S(a(r).failed_count)+" 条",1)):b("",!0),a(r).errors.length>0?(m(),v("div",q,[t[6]||(t[6]=s("p",{class:"font-medium"},"错误详情：",-1)),s("ul",z,[(m(!0),v(T,null,A(a(r).errors,n=>(m(),v("li",{key:n},"• "+S(n),1))),128))])])):b("",!0)])):b("",!0),s("div",F,[s("button",{type:"button",onClick:t[2]||(t[2]=n=>e.$emit("close")),class:"btn btn-secondary"},"取消"),s("button",{type:"button",onClick:x,class:"btn btn-primary",disabled:a(p)||!a(d).trim()},[a(p)?(m(),R(l,{key:0,name:"svg-spinners:90-ring",class:"w-4 h-4 mr-2"})):b("",!0),B(" "+S(a(p)?"导入中...":"开始导入"),1)],8,G)])])}}};export{J as _,N as u};
