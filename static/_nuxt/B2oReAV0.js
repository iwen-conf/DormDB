import{r as f,j as p,g as j,m as O,p as z,G as U,n as B,c as D,a as t,z as g,b as A,d as L,t as v,H as J,w as M,o as N,C as q}from"./UuX0VwB7.js";import{_ as G}from"./C6ijD7c3.js";import{apiClient as o}from"./CHvCcL-2.js";import"./f-SsayYv.js";const P=()=>{const n=f(!1),a=f(null),s=async(r,S={})=>{const{showLoading:k=!0,resetError:T=!0}=S;T&&(a.value=null),k&&(n.value=!0);try{return await r()}catch(w){const V=w instanceof Error?w.message:"请求失败";throw a.value=V,console.error("API请求失败:",w),w}finally{k&&(n.value=!1)}},m=()=>s(()=>o.healthCheck()),c=r=>s(()=>o.applyDatabase(r)),_=r=>s(()=>o.adminLogin(r)),i=()=>s(()=>o.getSystemStatus()),h=()=>s(()=>o.getApplicationStats()),y=r=>s(()=>o.getStudentIds(r)),b=r=>s(()=>o.addStudentId(r)),I=r=>s(()=>o.deleteStudentId(r)),x=r=>s(()=>o.batchImportStudentIds(r)),d=()=>s(()=>o.getStudentIdStats()),e=()=>s(()=>o.getAllUsers()),l=(r,S)=>s(()=>o.deleteUser(r,S)),u=()=>s(()=>o.getAllApplicants()),C=()=>o.isAuthenticated(),E=()=>{a.value=null};return{loading:p(n),error:p(a),execute:s,clearError:E,healthCheck:m,applyDatabase:c,adminLogin:_,getSystemStatus:i,getApplicationStats:h,getStudentIds:y,addStudentId:b,deleteStudentId:I,batchImportStudentIds:x,getStudentIdStats:d,getAllUsers:e,deleteUser:l,getAllApplicants:u,isAuthenticated:C,apiClient:o}},H=j("auth",()=>{const n=f(null),a=f(null),s=f(!1),m=f(!1),c=f(null),_=O(()=>n.value),i=O(()=>{if(!a.value)return!1;try{const{isTokenExpired:e}=require("~/utils/helpers");return!e(a.value)}catch{return!1}}),h=async e=>{m.value=!0,c.value=null;try{const u=await P().adminLogin(e.password);return u&&(a.value=u.token,n.value={username:"admin"},s.value=!0,localStorage.setItem("auth_token",u.token),localStorage.setItem("user_info",JSON.stringify(n.value))),u}catch(l){const u=l instanceof Error?l.message:"登录失败";throw c.value=u,l}finally{m.value=!1}},y=async()=>{try{n.value=null,a.value=null,s.value=!1,c.value=null,localStorage.removeItem("auth_token"),localStorage.removeItem("user_info"),await P().apiClient.adminLogout()}catch(e){console.error("登出失败:",e)}},b=async()=>{try{const e=localStorage.getItem("auth_token"),l=localStorage.getItem("user_info");if(e&&l){const{isTokenExpired:u}=require("~/utils/helpers");if(u(e))localStorage.removeItem("auth_token"),localStorage.removeItem("user_info");else return a.value=e,n.value=JSON.parse(l),s.value=!0,!0}return!1}catch(e){return console.error("检查认证状态失败:",e),!1}},I=async()=>{},x=e=>{n.value&&(n.value={...n.value,...e},localStorage.setItem("user_info",JSON.stringify(n.value)))},d=()=>{c.value=null};return b(),{user:p(n),token:p(a),isAuthenticated:p(s),loading:p(m),error:p(c),userInfo:_,hasValidToken:i,login:h,logout:y,checkAuthStatus:b,refreshToken:I,updateUser:x,clearError:d}}),$={class:"min-h-screen bg-gray-50 py-12 px-4"},F={class:"max-w-2xl mx-auto"},K={key:0,class:"flex justify-center py-8"},Q={key:1,class:"alert alert-error mb-6"},R={key:2,class:"card p-6"},W={class:"space-y-6"},X={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Y={class:"form-input bg-gray-50"},Z={class:"form-input bg-gray-50"},ee={class:"form-input bg-gray-50"},te={class:"form-input bg-gray-50"},se={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},re={class:"flex items-center"},ne={class:"form-input bg-gray-50"},oe={class:"mt-6 flex justify-end space-x-3"},le=["disabled"],ae={class:"mt-6 text-center"},me={__name:"profile",setup(n){const a=H(),{loading:s,error:m,clearError:c,isAuthenticated:_}=P(),i=f(null),h=O(()=>a.isAuthenticated),y=async()=>{try{i.value={id:"12345",username:"testuser",email:"test@example.com",created_at:new Date().toISOString(),last_login:new Date().toISOString()}}catch(d){console.error("获取用户资料失败:",d)}},b=()=>{y()},I=()=>{U("/user/edit")},x=d=>new Date(d).toLocaleString("zh-CN");return z(()=>{h.value?y():U("/login")}),B(h,d=>{d||U("/login")}),(d,e)=>{var C,E,r,S,k;const l=q,u=G;return N(),D("div",$,[t("div",F,[e[12]||(e[12]=t("div",{class:"text-center mb-8"},[t("h1",{class:"text-3xl font-bold text-gray-900"},"用户资料"),t("p",{class:"text-gray-600"},"查看和管理您的个人信息")],-1)),g(s)?(N(),D("div",K,[A(l,{name:"svg-spinners:90-ring",class:"w-8 h-8 text-blue-600"})])):g(m)?(N(),D("div",Q,[L(v(g(m))+" ",1),t("button",{onClick:e[0]||(e[0]=(...T)=>g(c)&&g(c)(...T)),class:"ml-2 text-red-800 hover:text-red-900"},[A(l,{name:"heroicons:x-mark",class:"w-4 h-4"})])])):(N(),D("div",R,[t("div",W,[t("div",null,[e[5]||(e[5]=t("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"基本信息",-1)),t("div",X,[t("div",null,[e[1]||(e[1]=t("label",{class:"form-label"},"用户ID",-1)),t("div",Y,v(((C=i.value)==null?void 0:C.id)||"-"),1)]),t("div",null,[e[2]||(e[2]=t("label",{class:"form-label"},"用户名",-1)),t("div",Z,v(((E=i.value)==null?void 0:E.username)||"-"),1)]),t("div",null,[e[3]||(e[3]=t("label",{class:"form-label"},"邮箱",-1)),t("div",ee,v(((r=i.value)==null?void 0:r.email)||"-"),1)]),t("div",null,[e[4]||(e[4]=t("label",{class:"form-label"},"注册时间",-1)),t("div",te,v((S=i.value)!=null&&S.created_at?x(i.value.created_at):"-"),1)])])]),t("div",null,[e[8]||(e[8]=t("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"账户状态",-1)),t("div",se,[t("div",null,[e[6]||(e[6]=t("label",{class:"form-label"},"认证状态",-1)),t("div",re,[t("span",{class:J(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",g(_)()?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},v(g(_)()?"已认证":"未认证"),3)])]),t("div",null,[e[7]||(e[7]=t("label",{class:"form-label"},"最后登录",-1)),t("div",ne,v((k=i.value)!=null&&k.last_login?x(i.value.last_login):"-"),1)])])])]),t("div",oe,[t("button",{onClick:b,class:"btn btn-secondary",disabled:g(s)},[A(l,{name:"heroicons:arrow-path",class:"w-4 h-4 mr-2"}),e[9]||(e[9]=L(" 刷新 "))],8,le),t("button",{onClick:I,class:"btn btn-primary"},[A(l,{name:"heroicons:pencil",class:"w-4 h-4 mr-2"}),e[10]||(e[10]=L(" 编辑资料 "))])])])),t("div",ae,[A(u,{to:"/",class:"text-sm text-blue-600 hover:text-blue-800"},{default:M(()=>e[11]||(e[11]=[L(" 返回首页 ")])),_:1,__:[11]})])])])}}};export{me as default};
