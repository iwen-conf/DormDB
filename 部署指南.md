# DormDB éƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åœ¨ä¸åŒç¯å¢ƒä¸­éƒ¨ç½² DormDB æ•°æ®åº“è‡ªåŠ©ç”³è¯·å¹³å°ã€‚

## ğŸ”§ ç³»ç»Ÿè¦æ±‚

### æœ€ä½é…ç½®
- **CPU**: 1 æ ¸å¿ƒ
- **å†…å­˜**: 512MB RAM
- **å­˜å‚¨**: 1GB å¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: ç¨³å®šçš„ç½‘ç»œè¿æ¥

### æ¨èé…ç½®
- **CPU**: 2+ æ ¸å¿ƒ
- **å†…å­˜**: 2GB+ RAM
- **å­˜å‚¨**: 10GB+ å¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: é«˜é€Ÿç½‘ç»œè¿æ¥

### è½¯ä»¶ä¾èµ–
- **Rust**: 1.70 æˆ–æ›´é«˜ç‰ˆæœ¬
- **MySQL**: 5.7+ æˆ– 8.0+
- **æ“ä½œç³»ç»Ÿ**: Linux (æ¨è), macOS, Windows

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### 1. ç¯å¢ƒå‡†å¤‡

#### å®‰è£… Rust
```bash
# å®‰è£… Rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source ~/.cargo/env

# éªŒè¯å®‰è£…
rustc --version
cargo --version
```

#### å‡†å¤‡ MySQL æ•°æ®åº“
ç¡®ä¿æœ‰ä¸€ä¸ª MySQL å®ä¾‹ï¼Œå¹¶ä¸”æœ‰ç®¡ç†å‘˜æƒé™çš„è´¦å·ã€‚

### 2. è·å–æºç 
```bash
git clone <repository-url>
cd DormDB
```

### 3. é…ç½®ç¯å¢ƒå˜é‡
```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
nano .env
```

**å¿…éœ€çš„ç¯å¢ƒå˜é‡**:
```bash
# MySQL é…ç½® (å¿…éœ€)
MYSQL_HOST=your-mysql-host
MYSQL_PORT=3306
MYSQL_USERNAME=your-admin-user
MYSQL_PASSWORD=your-admin-password
MYSQL_DATABASE=your-database
MYSQL_ALLOWED_HOST=localhost

# æœåŠ¡å™¨é…ç½® (å¯é€‰)
SERVER_HOST=127.0.0.1
SERVER_PORT=3000

# SQLite é…ç½® (å¯é€‰)
SQLITE_PATH=./dormdb_state.db
```

### 4. ç¼–è¯‘å’Œè¿è¡Œ
```bash
# å¼€å‘æ¨¡å¼
cargo run

# ç”Ÿäº§æ¨¡å¼
cargo build --release
./target/release/DormDB
```

### 5. éªŒè¯éƒ¨ç½²
è®¿é—® http://localhost:3000 ç¡®è®¤æœåŠ¡æ­£å¸¸è¿è¡Œã€‚

## ğŸ³ Docker éƒ¨ç½²

### 1. åˆ›å»º Dockerfile
```dockerfile
# å¤šé˜¶æ®µæ„å»º
FROM rust:1.70 as builder

WORKDIR /app
COPY . .
RUN cargo build --release

FROM debian:bookworm-slim

# å®‰è£…è¿è¡Œæ—¶ä¾èµ–
RUN apt-get update && apt-get install -y \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# å¤åˆ¶ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶
COPY --from=builder /app/target/release/DormDB /app/
COPY --from=builder /app/static /app/static

# åˆ›å»ºé root ç”¨æˆ·
RUN useradd -r -s /bin/false dormdb
USER dormdb

EXPOSE 3000

CMD ["./DormDB"]
```

### 2. æ„å»ºé•œåƒ
```bash
docker build -t dormdb:latest .
```

### 3. è¿è¡Œå®¹å™¨
```bash
docker run -d \
  --name dormdb \
  -p 3000:3000 \
  -e MYSQL_HOST=your-mysql-host \
  -e MYSQL_PORT=3306 \
  -e MYSQL_USERNAME=your-admin-user \
  -e MYSQL_PASSWORD=your-admin-password \
  -e MYSQL_DATABASE=your-database \
  -e MYSQL_ALLOWED_HOST=localhost \
  -v /path/to/data:/app/data \
  dormdb:latest
```

## ğŸ”§ Docker Compose éƒ¨ç½²

### 1. åˆ›å»º docker-compose.yml
```yaml
version: '3.8'

services:
  dormdb:
    build: .
    ports:
      - "3000:3000"
    environment:
      - MYSQL_HOST=mysql
      - MYSQL_PORT=3306
      - MYSQL_USERNAME=root
      - MYSQL_PASSWORD=rootpassword
      - MYSQL_DATABASE=dormdb
      - MYSQL_ALLOWED_HOST=%
      - SQLITE_PATH=/app/data/dormdb_state.db
    volumes:
      - ./data:/app/data
    depends_on:
      - mysql
    restart: unless-stopped

  mysql:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=rootpassword
      - MYSQL_DATABASE=dormdb
    volumes:
      - mysql_data:/var/lib/mysql
    ports:
      - "3306:3306"
    restart: unless-stopped

volumes:
  mysql_data:
```

### 2. å¯åŠ¨æœåŠ¡
```bash
docker-compose up -d
```

## â˜ï¸ äº‘å¹³å°éƒ¨ç½²

### AWS EC2 éƒ¨ç½²

#### 1. åˆ›å»º EC2 å®ä¾‹
- é€‰æ‹© Ubuntu 20.04 LTS
- å®ä¾‹ç±»å‹: t3.micro (å…è´¹å¥—é¤) æˆ–æ›´é«˜
- é…ç½®å®‰å…¨ç»„å¼€æ”¾ 3000 ç«¯å£

#### 2. è¿æ¥å®ä¾‹å¹¶éƒ¨ç½²
```bash
# è¿æ¥åˆ°å®ä¾‹
ssh -i your-key.pem ubuntu@your-ec2-ip

# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£… Rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source ~/.cargo/env

# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd DormDB

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
nano .env

# ç¼–è¯‘è¿è¡Œ
cargo build --release
nohup ./target/release/DormDB > dormdb.log 2>&1 &
```

### é˜¿é‡Œäº‘ ECS éƒ¨ç½²

ç±»ä¼¼ AWS EC2ï¼Œé€‰æ‹©åˆé€‚çš„å®ä¾‹è§„æ ¼å’Œæ“ä½œç³»ç»Ÿã€‚

### è…¾è®¯äº‘ CVM éƒ¨ç½²

å‚è€ƒ AWS EC2 éƒ¨ç½²æ­¥éª¤ã€‚

## ğŸ”’ ç”Ÿäº§ç¯å¢ƒé…ç½®

### 1. å®‰å…¨é…ç½®

#### ç¯å¢ƒå˜é‡å®‰å…¨
```bash
# ä½¿ç”¨å¼ºå¯†ç 
MYSQL_PASSWORD=your-very-strong-password

# é™åˆ¶è¿æ¥ä¸»æœº
MYSQL_ALLOWED_HOST=specific-host-ip

# ä½¿ç”¨éé»˜è®¤ç«¯å£
SERVER_PORT=8080
```

#### é˜²ç«å¢™é…ç½®
```bash
# Ubuntu/Debian
sudo ufw allow 3000/tcp
sudo ufw enable

# CentOS/RHEL
sudo firewall-cmd --permanent --add-port=3000/tcp
sudo firewall-cmd --reload
```

### 2. åå‘ä»£ç†é…ç½®

#### Nginx é…ç½®
```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

#### Apache é…ç½®
```apache
<VirtualHost *:80>
    ServerName your-domain.com
    
    ProxyPreserveHost On
    ProxyPass / http://127.0.0.1:3000/
    ProxyPassReverse / http://127.0.0.1:3000/
</VirtualHost>
```

### 3. SSL/HTTPS é…ç½®

#### ä½¿ç”¨ Let's Encrypt
```bash
# å®‰è£… Certbot
sudo apt install certbot python3-certbot-nginx

# è·å–è¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ : 0 12 * * * /usr/bin/certbot renew --quiet
```

### 4. ç³»ç»ŸæœåŠ¡é…ç½®

#### åˆ›å»º systemd æœåŠ¡
```bash
sudo nano /etc/systemd/system/dormdb.service
```

```ini
[Unit]
Description=DormDB Service
After=network.target

[Service]
Type=simple
User=dormdb
WorkingDirectory=/opt/dormdb
ExecStart=/opt/dormdb/DormDB
Restart=always
RestartSec=10
Environment=RUST_LOG=info

[Install]
WantedBy=multi-user.target
```

```bash
# å¯ç”¨æœåŠ¡
sudo systemctl enable dormdb
sudo systemctl start dormdb
sudo systemctl status dormdb
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### 1. æ—¥å¿—é…ç½®
```bash
# è®¾ç½®æ—¥å¿—çº§åˆ«
export RUST_LOG=info

# æ—¥å¿—è½®è½¬
sudo nano /etc/logrotate.d/dormdb
```

```
/var/log/dormdb/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 dormdb dormdb
}
```

### 2. å¥åº·æ£€æŸ¥
```bash
# åˆ›å»ºå¥åº·æ£€æŸ¥è„šæœ¬
#!/bin/bash
curl -f http://localhost:3000/api/v1/health || exit 1
```

### 3. æ€§èƒ½ç›‘æ§
- ä½¿ç”¨ `htop` ç›‘æ§ç³»ç»Ÿèµ„æº
- ä½¿ç”¨ `netstat` ç›‘æ§ç½‘ç»œè¿æ¥
- é…ç½® Prometheus + Grafana (å¯é€‰)

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥æ—¥å¿—
journalctl -u dormdb -f

# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep 3000

# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat .env
```

#### 2. MySQL è¿æ¥å¤±è´¥
```bash
# æµ‹è¯• MySQL è¿æ¥
mysql -h your-mysql-host -P 3306 -u your-username -p

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status
```

#### 3. æƒé™é—®é¢˜
```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /opt/dormdb/

# ä¿®å¤æƒé™
sudo chown -R dormdb:dormdb /opt/dormdb/
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®åº“ä¼˜åŒ–
- é…ç½® MySQL è¿æ¥æ± 
- ä¼˜åŒ– SQLite è®¾ç½®
- å®šæœŸæ¸…ç†æ—¥å¿—

### 2. ç³»ç»Ÿä¼˜åŒ–
- è°ƒæ•´æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
- é…ç½®å†…å­˜å‚æ•°
- ä½¿ç”¨ SSD å­˜å‚¨

### 3. ç½‘ç»œä¼˜åŒ–
- é…ç½® CDN (å¦‚æœéœ€è¦)
- å¯ç”¨ gzip å‹ç¼©
- ä¼˜åŒ– TCP å‚æ•°

## ğŸ”„ å¤‡ä»½å’Œæ¢å¤

### 1. æ•°æ®å¤‡ä»½
```bash
# SQLite å¤‡ä»½
cp dormdb_state.db dormdb_state.db.backup

# MySQL å¤‡ä»½
mysqldump -h host -u user -p database > backup.sql
```

### 2. è‡ªåŠ¨å¤‡ä»½è„šæœ¬
```bash
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
cp /opt/dormdb/dormdb_state.db /backup/dormdb_state_$DATE.db
find /backup -name "dormdb_state_*.db" -mtime +7 -delete
```

---

**æ³¨æ„**: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²å‰ï¼Œè¯·ç¡®ä¿å……åˆ†æµ‹è¯•æ‰€æœ‰åŠŸèƒ½ï¼Œå¹¶åˆ¶å®šå®Œæ•´çš„å¤‡ä»½å’Œæ¢å¤è®¡åˆ’ã€‚
